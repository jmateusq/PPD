
services:
  otimizador:
    build: .
    image: otimizador-cuda
    container_name: otimizador_cuda_container
    
    # Mapeia a pasta atual
    volumes:
      - .:/usr/src/app
    
    stdin_open: true 
    tty: true

    # --- CONFIGURAÇÃO DA GPU ---
    # Isso exige que você tenha o "NVIDIA Container Toolkit" instalado no host
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1          # Quantas GPUs usar (ou 'all')
              capabilities: [gpu]

    # Comando: Limpa compilações antigas, roda o make e executa
    # Assume que você criou o 'Makefile' que enviei na resposta anterior
    command: /bin/bash -c "rm -f *.o otimizador_gpu && nvcc -O3 -c KernelOtimizador.cu -o KernelOtimizador.o && g++ -O3 -c *.cpp && nvcc -O3 *.o -o otimizador_gpu && ./otimizador_gpu"